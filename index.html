<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angle of Elevation & Depression Game</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 10px; }

        #game-container {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 4px solid #fff;
        }

        canvas {
            display: block;
            background-color: #87CEEB; /* Sky Blue */
        }

        #controls {
            margin-top: 20px;
            padding: 20px;
            background-color: #34495e;
            border-radius: 8px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label { margin-bottom: 5px; font-weight: bold; }

        input[type="number"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            width: 80px;
            text-align: center;
            font-size: 16px;
        }

        select {
            padding: 8px;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }

        #btn-fire { background-color: #e74c3c; color: white; }
        #btn-new { background-color: #27ae60; color: white; }

        #message {
            margin-top: 15px;
            font-size: 18px;
            height: 24px;
            font-weight: bold;
            text-align: center;
        }

        /* Legend for educational purpose */
        #legend {
            margin-top: 10px;
            font-size: 14px;
            color: #bdc3c7;
        }
    </style>
</head>
<body>

    <h1>Angle of Elevation & Depression</h1>
    
    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <div id="message">Adjust settings and Fire!</div>

    <div id="controls">
        <div class="control-group">
            <label>Angle Type:</label>
            <select id="angleType">
                <option value="elevation">Angle of Elevation (Up)</option>
                <option value="depression">Angle of Depression (Down)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Degrees (0-90):</label>
            <input type="number" id="angleInput" min="0" max="90" value="0">
        </div>

        <button id="btn-fire">FIRE CANNON</button>
        <button id="btn-new">NEW TARGET</button>
    </div>

    <div id="legend">
        Tip: The dotted line is the Horizontal. Elevation is UP from horizontal, Depression is DOWN from horizontal.
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const angleInput = document.getElementById('angleInput');
    const angleTypeSelect = document.getElementById('angleType');
    const msgDiv = document.getElementById('message');
    const btnFire = document.getElementById('btn-fire');
    const btnNew = document.getElementById('btn-new');

    // Game State
    let cannonX = 50;
    let groundY = 300; // The middle line (horizon)
    
    let target = { x: 0, y: 0, hit: false, type: 'air' }; // type: air or ground
    let projectile = { x: 0, y: 0, active: false, vx: 0, vy: 0 };
    
    // Animation loop ID
    let animationId;

    function init() {
        spawnTarget();
        drawScene();
    }

    function spawnTarget() {
        // Reset state
        projectile.active = false;
        target.hit = false;
        msgDiv.textContent = "Enemy spotted! Calculate the angle.";
        msgDiv.style.color = "white";

        // Random X (keep it on the right half)
        target.x = Math.floor(Math.random() * 300) + 400; // 400 to 700

        // Random Y
        // Decide if above (Elevation) or below (Depression)
        // 0 to groundY is Sky (Elevation needed)
        // groundY to height is Underground (Depression needed)
        
        let isSky = Math.random() > 0.5;

        if (isSky) {
            target.type = 'air';
            // Spawn in upper area (padding of 50px)
            target.y = Math.floor(Math.random() * (groundY - 100)) + 50; 
        } else {
            target.type = 'ground';
            // Spawn in lower area
            target.y = Math.floor(Math.random() * (canvas.height - groundY - 100)) + groundY + 50;
        }

        drawScene();
    }

    function drawScene() {
        // 1. Clear Screen
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 2. Draw Backgrounds
        // Sky
        ctx.fillStyle = "#87CEEB";
        ctx.fillRect(0, 0, canvas.width, groundY);
        // Underground/Water
        ctx.fillStyle = "#5D4037"; // Brownish earth
        ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

        // 3. Draw The Horizontal Line (The "Horizon")
        ctx.beginPath();
        ctx.moveTo(0, groundY);
        ctx.lineTo(canvas.width, groundY);
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.setLineDash([10, 10]); // Dashed line
        ctx.stroke();
        ctx.setLineDash([]); // Reset dash

        // Label the Horizon
        ctx.fillStyle = "rgba(255,255,255,0.7)";
        ctx.font = "14px Arial";
        ctx.fillText("HORIZONTAL LINE OF SIGHT", 60, groundY - 5);

        // 4. Draw Cannon
        drawCannon();

        // 5. Draw Target
        drawTarget();

        // 6. Draw Projectile
        if (projectile.active) {
            ctx.beginPath();
            ctx.arc(projectile.x, projectile.y, 6, 0, Math.PI * 2);
            ctx.fillStyle = "yellow";
            ctx.fill();
            ctx.strokeStyle = "black";
            ctx.stroke();
        }
    }

    function drawCannon() {
        let barrelLength = 60;
        let angleDeg = parseFloat(angleInput.value) || 0;
        let mode = angleTypeSelect.value;
        
        // Clamp visual angle
        if (angleDeg < 0) angleDeg = 0;
        if (angleDeg > 90) angleDeg = 90;

        // Calculate visual rotation
        // In canvas, 0 is right. Positive is clockwise (down). Negative is counter-clockwise (up).
        let rotation = 0;
        if (mode === 'elevation') {
            rotation = -angleDeg * (Math.PI / 180);
        } else {
            rotation = angleDeg * (Math.PI / 180);
        }

        ctx.save();
        ctx.translate(cannonX, groundY);
        
        // Draw the Angle Arc
        ctx.beginPath();
        // Draw arc from 0 to rotation
        ctx.arc(0, 0, 40, 0, rotation, mode === 'elevation'); // true = anti-clockwise
        ctx.strokeStyle = "yellow";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Draw Angle Text
        ctx.fillStyle = "yellow";
        ctx.font = "12px Arial";
        let textY = mode === 'elevation' ? -15 : 15;
        ctx.fillText(angleDeg + "Â°", 45, textY);

        // Rotate for barrel
        ctx.rotate(rotation);

        // Draw Barrel
        ctx.fillStyle = "#333";
        ctx.fillRect(0, -10, barrelLength, 20);
        
        ctx.restore();

        // Draw Cannon Base (pivot point)
        ctx.beginPath();
        ctx.arc(cannonX, groundY, 15, 0, Math.PI * 2);
        ctx.fillStyle = "#555";
        ctx.fill();
    }

    function drawTarget() {
        if (target.hit) {
            // Draw Explosion
            ctx.beginPath();
            ctx.arc(target.x, target.y, 30, 0, Math.PI * 2);
            ctx.fillStyle = "orange";
            ctx.fill();
            ctx.fillStyle = "red";
            ctx.fillText("BOOM!", target.x - 20, target.y + 5);
            return;
        }

        if (target.type === 'air') {
            // Draw a simple helicopter/plane
            ctx.fillStyle = "#c0392b";
            ctx.fillRect(target.x - 20, target.y - 10, 40, 20);
            // Rotors
            ctx.fillStyle = "#222";
            ctx.fillRect(target.x - 25, target.y - 15, 50, 4);
        } else {
            // Draw a bunker/submarine
            ctx.fillStyle = "#8e44ad";
            ctx.beginPath();
            ctx.arc(target.x, target.y, 20, 0, Math.PI, true); // Semi circle
            ctx.fill();
            ctx.fillRect(target.x - 20, target.y, 40, 10);
        }

        // Draw Target Bulls-eye
        ctx.beginPath();
        ctx.arc(target.x, target.y, 5, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.fill();
    }

    function fire() {
        if (projectile.active) return; // Prevent spamming

        let angleDeg = parseFloat(angleInput.value);
        if (isNaN(angleDeg)) angleDeg = 0;
        
        // Clamp
        if (angleDeg < 0) angleDeg = 0;
        if (angleDeg > 90) angleDeg = 90;
        angleInput.value = angleDeg; // Update UI if clamped

        let mode = angleTypeSelect.value;
        let rad = angleDeg * (Math.PI / 180);

        projectile.x = cannonX;
        projectile.y = groundY;
        projectile.active = true;

        let speed = 15;

        // Calculate Velocity based on angle
        if (mode === 'elevation') {
            // Up and Right
            projectile.vx = Math.cos(rad) * speed;
            projectile.vy = -Math.sin(rad) * speed; // Negative Y is up
        } else {
            // Down and Right
            projectile.vx = Math.cos(rad) * speed;
            projectile.vy = Math.sin(rad) * speed; // Positive Y is down
        }

        // Check if logic matches target position immediately for feedback
        // Just for user feedback text, actual hit logic is in update loop
        if (mode === 'elevation' && target.y > groundY) {
            msgDiv.textContent = "Wrong mode! The enemy is below you.";
            msgDiv.style.color = "#ff6b6b";
        } else if (mode === 'depression' && target.y < groundY) {
            msgDiv.textContent = "Wrong mode! The enemy is above you.";
            msgDiv.style.color = "#ff6b6b";
        } else {
            msgDiv.textContent = "Firing...";
            msgDiv.style.color = "white";
        }

        animate();
    }

    function animate() {
        if (!projectile.active) return;

        // Move Projectile
        projectile.x += projectile.vx;
        projectile.y += projectile.vy;

        // Check Collision with Target (Simple Circle Collision)
        let dx = projectile.x - target.x;
        let dy = projectile.y - target.y;
        let distance = Math.sqrt(dx*dx + dy*dy);

        if (distance < 25) { // Hit radius
            target.hit = true;
            projectile.active = false;
            msgDiv.textContent = "Direct Hit! Well done.";
            msgDiv.style.color = "#2ecc71";
            drawScene(); // Final draw to show explosion
            return;
        }

        // Check Out of Bounds
        if (projectile.x > canvas.width || projectile.y > canvas.height || projectile.y < 0) {
            projectile.active = false;
            if(!target.hit) {
                msgDiv.textContent = "Miss! Try adjusting the angle.";
                msgDiv.style.color = "#f1c40f";
            }
            drawScene();
            return;
        }

        drawScene();
        animationId = requestAnimationFrame(animate);
    }

    // Event Listeners
    btnFire.addEventListener('click', fire);
    btnNew.addEventListener('click', init);
    
    // Update cannon drawing when inputs change
    angleInput.addEventListener('input', drawScene);
    angleTypeSelect.addEventListener('change', drawScene);

    // Initial Start
    init();

</script>
</body>
</html>